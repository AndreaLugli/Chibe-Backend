{% load static %}

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				{% if success %}
					Grazie per esserti registrato, hai gi√† guadagnato {{punti}} punti<br>
					Scarica l'app per completare il profilo e usare chibe
				{% else %}
					{% for message in messages %}
						<div class="alert {{ message.tags }} alert-dismissible" role="alert">
							<button type="button" class="close" data-dismiss="alert" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							{{ message }}
						</div>
					{% endfor %}

					<h1>{{utente}} ti ha invitato a registrarti a Chibe!</h1>
					<p>Completa il form per registrarti e guadagnare punti o accedi con i Social</p>

					<p>
						<a class="btn btn-primary" href="{% url 'social:begin' 'facebook' %}?user_code={{token}}&next={% url 'successo_invito' %}">Registrati con Facebook</a>
					</p>
					

					<p>
						<a class="btn btn-primary" href="{% url 'social:begin' 'google-plus' %}?user_code={{token}}&next={% url 'successo_invito' %}">Registrati con Google</a>
					</p>
<!--
					<p>
						<div id="google-plus-button">Google+ Sign In</div>
					</p>
-->
					<form method="POST">
						{% csrf_token %}
						<div class="form-group">
							<label>Email</label>
							<input type="email" class="form-control" name="email" required="">
						</div>
						<div class="form-group">
							<label>Password</label>
							<input type="password" class="form-control" name="password_1" required="">
						</div>
						<div class="form-group">
							<label>Conferma la password</label>
							<input type="password" class="form-control" name="password_2" required="">
						</div>
						<div class="form-group">
							<label>Username</label>
							<input type="text" class="form-control" name="username" required=""> 
						</div>
						<button type="submit" class="btn btn-primary">Registrarti</button>			
					</form>
				{% endif %}
			</div>
		</div>
	</div>	

	<script type="text/javascript" src="{% static 'bootstrap/jquery-3.2.1.slim.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'bootstrap/popper.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
	<script src="https://apis.google.com/js/api:client.js"></script>
<script type="text/javascript">
  gapi.load('auth2', function () {
    var auth2;

    auth2 = gapi.auth2.init({
      client_id: "{{CLIENT_ID}}",
      //ux_mode: "redirect",
      scope: "https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.me",
      //redirect_uri: "http://app.chibeapp.com/complete/google-plus/"
    });

    auth2.then(function () {
      var button = document.getElementById("google-plus-button");
      console.log("User is signed-in in Google+ platform?", auth2.isSignedIn.get() ? "Yes" : "No");

      auth2.attachClickHandler(button, {}, function (googleUser) {
        // Send access-token to backend to finish the authenticate
        // with your application

        var authResponse = googleUser.getAuthResponse();
        var $form;
        var $input;

        $form = $("<form>");
        $form.attr("action", "/complete/google-plus");
        $form.attr("method", "post");
        $input = $("<input>");
        $input.attr("name", "id_token");
        $input.attr("value", authResponse.id_token);
        $form.append($input);
        // Add csrf-token if needed
        $(document.body).append($form);
        $form.submit();
      });
    });
  });
</script>	
</body>
</html>